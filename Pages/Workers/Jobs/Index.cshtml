@page "/Worker/{workerId}/MyJobs"
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model Pages.Workers.Jobs.Index

@{
    ViewData["Title"] = "My jobs";
    var jobs = Model.Jobs;
    var finishedJobs = Model.FinishedJobs;
}

@if (jobs.Any())
{
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4 ms-5 me-5 ms-md-0 me-md-0">
        @foreach (var job in jobs)
        {
            if (job?.Id == null) continue;

            var dateOfBegin = job.DateOfBegin;
            var currentDate = DateTime.UtcNow;

            var years = dateOfBegin.Year - currentDate.Year;
            int months;
            int days;

            if (years == 0) months = dateOfBegin.Month - currentDate.Month;
            else months = 12 - currentDate.Month + dateOfBegin.Month;

            if ((dateOfBegin.Day - currentDate.Day) <= 0)
            {
                months -= 1;
                days = dateOfBegin.Day + DateTime.DaysInMonth(dateOfBegin.Year, dateOfBegin.Month) - currentDate.Day;
            }
            else days = dateOfBegin.Day - currentDate.Day;

            if (dateOfBegin.Month - currentDate.Month <= 0) years -= 1;
            if (months >= 12) months -= 12;


            <div class="col">
                <div class="card border-dark text-center h-100">
                    <div class="card-header bg-white">
                        <h4 class="card- m-0">@job.Name.ToUpper() </h4>
                    </div>
                    <div class="card-header bg-white">
                        <h5 class="card-title">
                            @if (dateOfBegin > currentDate)
                            {
                                <span class="badge border border-warning text-dark rounded-pill mb-1 mt-2">
                                    <h5 class="m-0"> Starting in
                                        @if (years > 0)
                                        {
                                            @(years + " year ")
                                        }
                                        @if (months > 0)
                                        {
                                            @(months + " months ")
                                        }

                                        @if (days > 0)
                                        {
                                            @(days + " days ")
                                        }
                                    </h5>
                                </span>
                                <br/>
                            }
                            else if (dateOfBegin.AddDays(job.Duration) > currentDate)
                            {
                                <span class="badge border border-success text-dark rounded-pill mb-2 mt-2">
                                    <h5 class="m-0"> Currently in progress</h5>
                                </span>
                            }
                        </h5>
                    </div>
                    <div class="card-text mt-2 mb-2 bg-white">
                        <div class="d-flex flex-column justify-content-around mb-2">
                            <div class="d-flex flex-row justify-content-evenly">
                                <div class="d-flex justify-content-around mb-2">
                                    <a class="btn btn-outline-blue position-relative" asp-page="/Jobs/Information"
                                       asp-route-jobId="@job.Id">
                                        Profile
                                    </a>
                                </div>
                                <div>
                                    <a class="btn btn-outline-success position-relative" asp-page="/Jobs/Application"
                                       asp-route-jobId="@job.Id">
                                        Application
                                    </a>
                                </div>
                            </div>
                            <div>
                                <a class="btn btn-outline-dark position-relative" asp-page="/Employers/Profile" asp-route-employerId="@job.EmployerId"
                                   asp-route-jobId="@job.Id">
                                    Employer
                                </a>
                            </div>

                        </div>
                        <div class="d-flex justify-content-center">
                            <a asp-page="/Jobs/Index"
                               class="link-blue link-underline-opacity-25 link-underline-opacity-100-hover">See more jobs</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}

@if (finishedJobs.Any())
{
    <div class="d-flex d-md-block justify-content-center ms-md-2">
        <span class="badge border border-secondary text-secondary mb-3 mt-5" style="">
        <h4 class="m-0">Finished</h4>
    </span>
    </div>
    
    
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4 ms-5 me-5 ms-md-0 me-md-0">
        @foreach (var finishedJob in finishedJobs)
        {
            if (finishedJob == null) continue;
            <div class="col">
                <div class="card text-bg-secondary-subtle text-center h-100">
                    <div class="card-header bg-white">
                        <h4 class="card-title">@finishedJob.Name </h4>
                    </div>

                    <div class="card-footer bg-white">
                        <div class="d-flex justify-content-center mb-3">
                            <a class="btn btn-outline-dark" asp-page="/Jobs/Information" asp-route-jobId="@finishedJob.Id">Information</a>
                        </div>
                        <div class="d-flex justify-content-evenly">
                            <div>
                                <a class="btn btn-outline-warning" asp-page="/Jobs/AddReview" asp-route-jobId="@finishedJob.Id">Rate job</a>
                            </div>
                            <div>
                                <a class="btn btn-outline-warning" asp-page="/Employers/AddReview" asp-route-employerId="@finishedJob.EmployerId">Rate employer</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}

@if(!finishedJobs.Any() && !jobs.Any())
{
    <span class="badge border border-warning text-dark position-relative mb-2 mt-5">
        <h5 class="m-0 text-dark">No current or finished jobs</h5>
    </span>
    <br/>
    <a class="text-blue" asp-page="/Jobs/Index">Find job</a>
}
